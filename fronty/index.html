<html>
<head>

    <style>
        html, body {
            width: 100%;
            height: 100%;
            background: url("./Artboard 6jpg.jpg") no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
            margin: 0;
            padding: 0
        }

        .videostream {
            position: absolute;
            right: 50px;
            top: 60px;
            width: 260px;
        }

    </style>

</head>
<body>

    <video class="videostream" autoplay=""></video>

    <img id="screenshot-img" src="">

<div id="screenshot" style="text-align:center;">

    <p>
        <button id="screenshot-button">Take screenshot</button>
    </p>

    <span id="finaltext"></span> ... <span id="concepttext"></span>
</div>

<script>
    let sentences = {
        happy: {
            teens: [
                "What's the best thing that's happened to you this year?",
                "What's the most important thing I should know about you?",
                "Have you seen any good movies lately?",
                "Do you have any brothers or sisters?",
                "What do you do for fun on the weekend?",
            ],
            adults: [],
            seniors: []
        },
        natural: {
            teens: [],
            adults: [],
            seniors: []
        },
        sad: {
            teens: [],
            adults: [],
            seniors: []
        }
    }

    const screenshotButton = document.querySelector('#screenshot-button');
    const img = document.querySelector('#screenshot img');
    const video = document.querySelector('#screenshot video');
    const canvas = document.createElement('canvas');

    const videoElement = document.querySelector('video');
    const finaltextElement = document.querySelector('span#finaltext');
    const concepttextElement = document.querySelector('span#concepttext');

    screenshotButton.onclick = function () {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        // Other browsers will fall back to image/png
        img.src = canvas.toDataURL();
        console.log(img.src);
    };
    var recognition;

    function startRecognition() {
        recognition = new webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = true;
        recognition.maxAlternatives = 1;
        recognition.lang = "en-US"

        recognition.onstart = function (e) {
            console.log(e)
        }
        recognition.onresult = function (e) {
            let finaltxt = "";
            let concepttxt = "";
            for (let i = 0; i < e.results.length; i++) {
                let result = e.results[i];
                if (result.isFinal) {
                    finaltxt += " " + result[0].transcript;
                } else {
                    concepttxt += " " + result[0].transcript;
                }
            }
            finaltextElement.innerHTML = finaltxt;
            concepttextElement.innerHTML = concepttxt;
        }
        recognition.onerror = function (e) {
            console.log(e)
        }
        recognition.onend = function (e) {
            recognition.start();
            console.log(e);
        }
        recognition.start();
    }

    function gotStream(stream) {
        window.stream = stream; // make stream available to console
        videoElement.srcObject = stream;
        // stream.getAudioTracks()[0].stop()
    }

    function handleError(error) {
        console.error('Error: ', error);
    }

    function startVideo() {
        navigator.mediaDevices.getUserMedia({
            video: true
        }).then(gotStream).catch(handleError);
    }

    window.onload = function () {
        console.log("loaded")
        startRecognition();
        startVideo();
    };
</script>
</body>
</html>